<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Galerie</title>

<style>
    body { font-family: Arial; padding: 20px; margin: 0; }

    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 20px;
    }

    .item {
        display: flex;
        flex-direction: column;
        gap: 6px;
        position: relative;
    }

    .item img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
        cursor: pointer;
    }

    .title {
        font-weight: bold;
        font-size: 15px;
    }
    .desc {
        font-size: 14px;
        color: #444;
        white-space: pre-line;
    }

    .delete-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(200,0,0,0.9);
        color: white;
        border: none;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        font-size: 18px;
        line-height: 26px;
        cursor: pointer;
        z-index: 10;
    }

    #fullscreen {
        position: fixed; inset:0;
        display:none;
        justify-content:center;
        align-items:center;
        background:rgba(0,0,0,0.9);
        z-index:9999;
    }
    #fullscreen img {
        max-width:95%;
        max-height:95%;
        border-radius:10px;
    }
</style>
</head>

<body>
<!--
<a href="index.html">⬅️ Zurück</a>
-->
<h2>Galerie</h2>

<div id="status">Lade Konfiguration…</div>
<div id="gallery" class="grid"></div>

<div id="fullscreen">
    <img id="fullImg">
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// ---------------------------------------------------------
// Fallback Config
// ---------------------------------------------------------
const fallbackConfig = {
    apiKey: "DEIN_API_KEY",
    authDomain: "DEIN_PROJEKT.firebaseapp.com",
    databaseURL: "https://DEIN_PROJEKT-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "DEIN_PROJEKT",
    messagingSenderId: "DEINE_SENDER_ID",
    appId: "DEINE_APP_ID"
};

// Versuch config.json zu laden
async function loadConfig(){
    try{
        const r = await fetch("config.json");
        if(!r.ok) throw new Error();
        return await r.json();
    } catch(e){
        return fallbackConfig;
    }
}

async function start(){
    const cfg = await loadConfig();
    firebase.initializeApp(cfg);
    const db = firebase.database();

    const status = document.getElementById("status");
    const gallery = document.getElementById("gallery");

    const fullscreen = document.getElementById("fullscreen");
    const fullImg = document.getElementById("fullImg");

    status.textContent = "Lade Bilder…";

    db.ref("bilder").on("value", snapshot => {
        gallery.innerHTML = "";
        const data = snapshot.val();

        if(!data){
            status.textContent = "Noch keine Bilder.";
            return;
        }

        status.textContent = "";

        Object.entries(data).reverse().forEach(([id, item]) => {
            const div = document.createElement("div");
            div.className = "item";

            const img = document.createElement("img");
            img.src = item.url;
            img.onclick = () => openFullscreen(item.url);

            // Text
            const title = item.title ? `<div class="title">${item.title}</div>` : "";
            const desc = item.desc ? `<div class="desc">${item.desc}</div>` : "";

            const text = document.createElement("div");
            text.innerHTML = title + desc;

            // Löschen
            const del = document.createElement("button");
            del.className = "delete-btn";
            del.textContent = "×";
            /*
            del.onclick = (e)=>{
                e.stopPropagation();
                if(confirm("Dieses Bild löschen?")){
                    db.ref("bilder/"+id).remove();
                }
            };*/

            div.appendChild(img);
            div.appendChild(del);
            div.appendChild(text);

            gallery.appendChild(div);
        });
    });

    function openFullscreen(url){
        fullImg.src = url;
        fullscreen.style.display = "flex";
    }
    fullscreen.onclick = ()=> fullscreen.style.display="none";
}

start();
</script>

</body>
</html>